<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Windowing</title>
  <meta name="description" content="Distributed, masterless, high performance, fault tolerant data processing
">

  <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-72807409-1', 'auto');
	  ga('send', 'pageview');
  </script>

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/lavish-bootstrap.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/cheat-sheet-style.css">
  <link rel="canonical" href="http://www.onyxplatform.org/docs/user-guide/latest/windowing.html">
  <link rel="alternate" type="application/rss+xml" title="Onyx" href="http://www.onyxplatform.org/feed.xml" />
</head>



  <body>
    <header class="site-header">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-1">
        <h2><a id="nav-title" href="/">Onyx</a></h2>
      </div>
      <div class="col-md-1"></div>
      <div class="col-md-6">
        <ul class="nav nav-pills navbar-right">
          <li class="nav-choice" role="presentation"><a href="/learn">learn</a></li>
          <li class="nav-choice" role="presentation"><a href="/docs">docs</a></li>
          <li class="nav-choice" role="presentation"><a href="/tools">tools</a></li>
          <li class="nav-choice" role="presentation"><a href="/blog">blog</a></li>
          <li class="nav-choice" role="presentation"><a href="https://github.com/onyx-platform/onyx">github</a></li>
          <li class="nav-choice" role="presentation"><a href="/support">support</a></li>
          <li class="nav-choice" role="presentation"><a href="/team">team</a></li>
        </ul>
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>
</header>

    <div class="container-fluid">
  <div class="row">
    <div class="col-md-2 panel page-contents">
      <h4>Contents</h4>
      <ul>
  <li><a href="/docs/cheat-sheet/latest">cheat sheet</a></li>
  <li><a href="/docs/api/0.9.8">api docs</a></li>
  <li>user guide</li>
  <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/aggregation-state-management.html">Aggregation and State</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/apis.html">APIs</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/architecture-low-level-design.html">Architecture</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/backpressure.html">Backpressure</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/concepts.html">Concepts</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/core-async-plugin.html">core.async Plugin</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/deployment.html">Deployment</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/environment.html">Environment</a></li>
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/examples.html">Examples</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/faq.html">FAQ</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/flow-conditions.html">Flow Conditions</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/functions.html">Functions</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/information-model.html">Information Model</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/lifecycles.html">Lifecycles</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/logging.html">Logging</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/messaging.html">Messaging</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/monitoring.html">Monitoring</a></li>
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/peer-config.html">Peer Configuration</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/performance-tuning.html">Performance Tuning</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/plugins.html">Plugins</a></li>
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/production-check-list.html">Production Checklist</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/scheduling.html">Scheduling</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/subscription.html">Subscription</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/testing-onyx-jobs.html">Testing Onyx Jobs</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/triggers.html">Triggers</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/what-does-it-offer.html">What does it Offer?</a></li>
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/docs/user-guide/latest/windowing.html">Windowing</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
  <!--li> Production</li>
  <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul-->

</ul>

    </div>
    <div class="col-md-1"></div>
    <div class="col-md-7 panel">
      <h2 id="windowing-and-aggregation">Windowing and Aggregation</h2>

<p>This section discusses a feature called windowing. Windows allow you to group and accrue data into possibly overlapping buckets.  Windows are intimately related to the Triggers feature. When you’re finished reading this section, head over to the Triggers chapter next.</p>

<h3 id="summary">Summary</h3>

<p>Windowing splits up a possibly unbounded data set into finite, possibly overlapping portions. Windows allow us create aggregations over distinct portions of a stream, rather than stalling and waiting for the entire data data set to arrive. In Onyx, Windows strictly describe how data is accrued. When you want to <em>do</em> something with the windowed data, you use a Trigger. See the chapter on Triggers for more information. Onyx’s windowing mechanisms are strong enough to handle stream disorder. If your data arrives in an order that isn’t “logical” (for example, <code>:event-time</code> keys moving backwards in time), Onyx can sort out the appropriate buckets to put the data in.</p>

<h3 id="window-types">Window Types</h3>

<p>The topic of windows has been widely explored in the literature. There are different <em>types</em> of windows. Currently, Onyx supports Fixed, Sliding, Global, and Session windows. We will now explain the supported window types.</p>

<h4 id="fixed-windows">Fixed Windows</h4>

<p>Fixed windows, sometimes called Tumbling windows, span a particular range and do not slide. That is, fixed windows never overlap one another. Consequently, a data point will fall into exactly one instance of a window (often called an <em>extent</em> in the literature). As it turns out, fixed windows are a special case of sliding windows where the range and slide values are equal. You can see a visual below of how this works, where the <code>|--|</code> drawings represent extents. Each window is of range <code>5</code>. Time runs horizontally, while the right-hand side features the extent bound running vertically. The first extent captures all values between 0 and 4.99999…</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>1, 5, 10, 15, 20, 25, 30, 35, 40
|--|                                [0  - 4]
   |--|                             [5  - 9]
      |---|                         [10 - 14]
          |---|                     [15 - 19]
              |---|                 [20 - 24]
                  |---|             [25 - 29]
                      |---|         [30 - 34]
                          |---|     [35 - 39]
</pre></div>
</div>
</div>

<p>Example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/count</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">5</span> <span style="color:#A60">:minutes</span>]}
</pre></div>
</div>
</div>

<p>Example project: <a href="https://github.com/onyx-platform/onyx-examples/tree/0.9.x/fixed-windows">fixed-windows</a></p>

<h4 id="sliding-windows">Sliding Windows</h4>

<p>In contrast to fixed windows, sliding windows allow extents to overlap. When a sliding window is specified, we have to give it a range for which the window spans, and a <em>slide</em> value for how long to wait between spawning a new window extent. Every data point will fall into exactly <code>range / slide</code> number of window extents. We draw out what this looks like for a sliding window with range <code>15</code> and slide <code>5</code>:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>1, 5, 10, 15, 20, 25, 30, 35, 40
|---------|                         [0  - 14]
   |----------|                     [5  - 19]
      |-----------|                 [10 - 24]
          |-----------|             [15 - 29]
              |-----------|         [20 - 34]
                  |-----------|     [25 - 39]
</pre></div>
</div>
</div>

<p>Example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:sliding</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/conj</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">15</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/slide</span> [<span style="color:#00D">5</span> <span style="color:#A60">:minute</span>]}
</pre></div>
</div>
</div>

<p>Example project: <a href="https://github.com/onyx-platform/onyx-examples/tree/0.9.x/sliding-windows">sliding-windows</a></p>

<h4 id="global-windows">Global Windows</h4>

<p>Global windows are perhaps the easiest to understand. With global windows, there is exactly one window extent that match all data that enters it. This lets you capture events that span over an entire domain of time. Global windows are useful for modeling batch or timeless computations.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>&lt;- Negative Infinity                Positive Infinity -&gt;
|-------------------------------------------------------|
</pre></div>
</div>
</div>

<p>Example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:global</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/count</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>}]
</pre></div>
</div>
</div>

<p>Example project: <a href="https://github.com/onyx-platform/onyx-examples/tree/0.9.x/global-windows">global-windows</a></p>

<h4 id="session-windows">Session Windows</h4>

<p>Session windows are windows that dynamically resize their upper and lower bounds in reaction to incoming data. Sessions capture a time span of activity for a specific key, such as a user ID. If no activity occurs within a timeout gap, the session closes. If an event occurs within the bounds of a session, the window size is fused with the new event, and the session is extended by its timeout gap either in the forward or backward direction.</p>

<p>For example, if events with the same session key occured at <code>5</code>, <code>7</code>, and <code>20</code>, and the session window used a timeout gap of 5, the windows would look like the following:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>1, 5, 10, 15, 20, 25, 30, 35, 40
   |-|                           [5 - 7]
              |                  [20 - 20]
</pre></div>
</div>
</div>

<p>Windows that aren’t fused to anything are single points in time (see <code>20</code>). If an event occurs before or after its timeout gap on the timeline, the two events fuse, as <code>5</code>, and <code>7</code> do.</p>

<p>Example:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:session</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/conj</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/session-key</span> <span style="color:#A60">:id</span>
 <span style="color:#A60">:window/timeout-gap</span> [<span style="color:#00D">5</span> <span style="color:#A60">:minutes</span>]}]
</pre></div>
</div>
</div>

<p>Example project: <a href="https://github.com/onyx-platform/onyx-examples/tree/0.9.x/session-windows">session-windows</a></p>

<h3 id="units">Units</h3>

<p>Onyx allows you to specify range and slide values in different magnitudes of units, so long as the units can be coverted to the same unit in the end. For example, you can specify the range in minutes, and the slide in seconds. Any value that requires units takes a vector of two elements. The first element represents the value, and the second the unit. For example, window specifications denoting range and slide might look like:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/range</span> [<span style="color:#00D">1</span> <span style="color:#A60">:minute</span>]
 <span style="color:#A60">:window/slide</span> [<span style="color:#00D">30</span> <span style="color:#A60">:seconds</span>]}
</pre></div>
</div>
</div>

<p>See the information model for all supported units. You can use a singular form (e.g. <code>:minute</code>) instead of the plural (e.g. <code>:minutes</code>) where it makes sense for readability.</p>

<p>Onyx is also capable of sliding by <code>:elements</code>. This is often referred to as “slide-by-tuple” in research. Onyx doesn’t require a time-based range and slide value. Any totally ordered value will work equivalently.</p>

<h3 id="aggregation">Aggregation</h3>

<p>Windows allow you accrete data over time. Sometimes, you want to store all the data. Othertimes you want to incrementally compact the data. Window specifications must provide a <code>:window/aggregation</code> key. We’ll go over an example of every type of aggregation that Onyx supports.</p>

<h4 id="onyxwindowingaggregationconj"><code>:onyx.windowing.aggregation/conj</code></h4>

<p>The <code>:conj</code> aggregation is the simplest. It collects segments for this window and retains them in a vector, unchanged.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:sliding</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/conj</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">30</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/slide</span> [<span style="color:#00D">5</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Collects segments on a 30 minute window sliding every 5 minutes</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationcount"><code>:onyx.windowing.aggregation/count</code></h4>

<p>The <code>:onyx.windowing.aggregation/count</code> operation counts the number of segments in the window.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:count-segments</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> <span style="color:#A60">:onyx.windowing.aggregation/count</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">1</span> <span style="color:#A60">:hour</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Counts segments in one hour fixed windows</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationsum"><code>:onyx.windowing.aggregation/sum</code></h4>

<p>The <code>:sum</code> operation adds the values of <code>:age</code> for all segments in the window.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:sum-ages</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> [<span style="color:#A60">:onyx.windowing.aggregation/sum</span> <span style="color:#A60">:age</span>]
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">1</span> <span style="color:#A60">:hour</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Adds the :age key in all segments in 1 hour fixed windows</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationmin"><code>:onyx.windowing.aggregation/min</code></h4>

<p>The <code>:min</code> operation retains the minimum value found for <code>:age</code>. An initial value must be supplied via <code>:window/init</code>.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:min-age</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> [<span style="color:#A60">:onyx.windowing.aggregation/min</span> <span style="color:#A60">:age</span>]
 <span style="color:#A60">:window/init</span> <span style="color:#00D">100</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">30</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finds the minimum :age in 30 minute fixed windows, default is 100</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationmax"><code>:onyx.windowing.aggregation/max</code></h4>

<p>The <code>:max</code> operation retains the maximum value found for <code>:age</code>. An initial value must be supplied via <code>:window/init</code>.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:max-age</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> [<span style="color:#A60">:onyx.windowing.aggregation/max</span> <span style="color:#A60">:age</span>]
 <span style="color:#A60">:window/init</span> <span style="color:#00D">0</span>
 <span style="color:#A60">:window/max-key</span> <span style="color:#A60">:age</span>
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">30</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finds the maximum :age in 30 minute fixed windows, default is 0</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationaverage"><code>:onyx.windowing.aggregation/average</code></h4>

<p>The <code>:average</code> operation maintains an average over <code>:age</code>. The state is maintained as a map with three keys - <code>:n</code>, the number of elements, <code>:sum</code>, the running sum, and <code>:average</code>, the running average.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:average-age</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> [<span style="color:#A60">:onyx.windowing.aggregation/average</span> <span style="color:#A60">:age</span>]
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">30</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finds the average :age in 30 minute fixed windows, default is 0</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="onyxwindowingaggregationcollect-by-key"><code>:onyx.windowing.aggregation/collect-by-key</code></h4>

<p>The <code>:collect-by-key</code> operation maintains a collection of all segments with a common key.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>{<span style="color:#A60">:window/id</span> <span style="color:#A60">:collect-members</span>
 <span style="color:#A60">:window/task</span> <span style="color:#A60">:identity</span>
 <span style="color:#A60">:window/type</span> <span style="color:#A60">:fixed</span>
 <span style="color:#A60">:window/aggregation</span> [<span style="color:#A60">:onyx.windowing.aggregation/collect-by-key</span> <span style="color:#A60">:team</span>]
 <span style="color:#A60">:window/window-key</span> <span style="color:#A60">:event-time</span>
 <span style="color:#A60">:window/range</span> [<span style="color:#00D">30</span> <span style="color:#A60">:minutes</span>]
 <span style="color:#A60">:window/doc</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Collects all users on the same :team in 30 minute fixed windows</span><span style="color:#710">&quot;</span></span>}
</pre></div>
</div>
</div>

<h4 id="grouping">Grouping</h4>

<p>All of the above aggregates have slightly different behavior when <code>:onyx/group-by-key</code> or <code>:onyx/group-by-fn</code> are specified on the catalog entry. Instead of the maintaining a scalar value in the aggregate, Onyx maintains a map. The keys of the map are the grouped values, and values of the map are normal scalar aggregates.</p>

<p>For example, if you had the catalog entry set to <code>:onyx/group-by-key</code> with value <code>:name</code>, and you used a window aggregate of <code>:onyx.windowing.aggregation/count</code>, and you sent through segments <code>[{:name "john"} {:name "tiffany"} {:name "john"}]</code>, the aggregate map would look like <code>{"john" 2 "tiffany" 1}</code>.</p>

<h3 id="window-specification">Window Specification</h3>

<p>See the Information Model chapter for an exact specification of what values the Window maps need to supply. Here we will describe what each of the keys mean.</p>

<table>
  <thead>
    <tr>
      <th>key name</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>:window/id</code></td>
      <td>A unique identifier per window</td>
    </tr>
    <tr>
      <td><code>:window/task</code></td>
      <td>The workflow task over which the window operates</td>
    </tr>
    <tr>
      <td><code>:window/type</code></td>
      <td>Which type of window this is (fixed, sliding, etc)</td>
    </tr>
    <tr>
      <td><code>:window/aggregation</code></td>
      <td>The aggregation function to apply, as described above. If this operation is over a key, this is a vector, with the second element being the key.</td>
    </tr>
    <tr>
      <td><code>:window/window-key</code></td>
      <td>The key over which the range will be calculated</td>
    </tr>
    <tr>
      <td><code>:window/range</code></td>
      <td>The span of the window</td>
    </tr>
    <tr>
      <td><code>:window/slide</code></td>
      <td>The delay to wait to start a new window after the previous window</td>
    </tr>
    <tr>
      <td><code>:window/init</code></td>
      <td>The initial value required for some types of aggregation</td>
    </tr>
    <tr>
      <td><code>:window/min-value</code></td>
      <td>A strict mininum value that <code>:window/window-key</code> can ever be, default is 0.</td>
    </tr>
    <tr>
      <td><code>:window/doc</code></td>
      <td>An optional docstring explaining the window’s purpose</td>
    </tr>
  </tbody>
</table>

    </div>
  </div>
</div>


    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <small><center>Copyright © Distributed Masonry 2016</center></small>
    </div>

  </div>

</footer>

  </body>

</html>
