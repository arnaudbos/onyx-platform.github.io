<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Monitoring</title>
  <meta name="description" content="Distributed, masterless, high performance, fault tolerant data processing
">

  <link rel="stylesheet" href="/onyx-website/css/main.css">
  <link rel="stylesheet" href="/onyx-website/css/lavish-bootstrap.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/onyx-website/css/style.css">
  <link rel="stylesheet" href="/onyx-website/css/cheat-sheet-style.css">
  <link rel="canonical" href="http://www.onyxplatform.org/onyx-website/docs/user-guide/monitoring.html">
  <link rel="alternate" type="application/rss+xml" title="Onyx" href="http://www.onyxplatform.org/onyx-website/feed.xml" />
</head>



  <body>
    <header class="site-header">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-1">
        <h2><a id="nav-title" href="/onyx-website/">Onyx</a></h2>
      </div>
      <div class="col-md-1"></div>
      <div class="col-md-6">
        <ul class="nav nav-pills navbar-right">
          <li class="nav-choice" role="presentation"><a href="/onyx-website/learn">learn</a></li>
          <li class="nav-choice" role="presentation"><a href="/onyx-website/docs">docs</a></li>
          <li class="nav-choice" role="presentation"><a href="/onyx-website/tools">tools</a></li>
          <li class="nav-choice" role="presentation"><a href="/onyx-website/blog">blog</a></li>
          <li class="nav-choice" role="presentation"><a href="https://github.com/onyx-platform/onyx">github</a></li>
          <li class="nav-choice" role="presentation"><a href="/onyx-website/support">support</a></li>
          <li class="nav-choice" role="presentation"><a href="/onyx-website/team">team</a></li>
        </ul>
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>
</header>

    <div class="container-fluid">
  <div class="row">
    <div class="col-md-2 panel page-contents">
      <h4>Contents</h4>
      <ul>
  <li><a href="/onyx-website/docs/cheat-sheet">cheat sheet</a></li>
  <li><a href="/onyx-website/docs/api">api docs</a></li>
  <li>user guide</li>
  <ul>
    
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/aggregation-state-management.html">Aggregation and State</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/apis.html">APIs</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/architecture-low-level-design.html">Architecture</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/backpressure.html">Backpressure</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/concepts.html">Concepts</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/core-async-plugin.html">core.async Plugin</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/deployment.html">Deployment</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/environment.html">Environment</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/examples.html">Examples</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/faq.html">FAQ</a></li>
    
    
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/flow-conditions.html">Flow Conditions</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/functions.html">Functions</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/information-model.html">Information Model</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/lifecycles.html">Lifecycles</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/logging.html">Logging</a></li>
    
    
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/messaging.html">Messaging</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/monitoring.html">Monitoring</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/peer-config.html">Peer Configuration</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/performance-tuning.html">Performance Tuning</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/plugins.html">Plugins</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/production-check-list.html">Production Checklist</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/scheduling.html">Scheduling</a></li>
    
    
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/subscription.html">Subscription</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/testing-onyx-jobs.html">Testing Onyx Jobs</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/triggers.html">Triggers</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/what-does-it-offer.html">What does it Offer?</a></li>
    
    
    
    <li class="docs-section"><a href="/onyx-website/docs/user-guide/windowing.html">Windowing</a></li>
    
    
  </ul>
</ul>

    </div>
    <div class="col-md-1"></div>
    <div class="col-md-7 panel">
      <h2 id="monitoring">Monitoring</h2>

<p>When setting up an Onyx cluster in production, it&#39;s helpful to know what Onyx itself is doing. Onyx exposes a set of callbacks that are triggered on certain actions.</p>

<h3 id="monitoring-hooks">Monitoring Hooks</h3>

<p>When you&#39;re taking Onyx to production, it&#39;s not enough to know what your application-specific code is doing. You need to have insight into how Onyx is operating internally to be able to tune performance at an optimal level. Onyx allows you to register callbacks that are invoked when critical sections of code are exexcuted in Onyx, returning a map that includes latency and data load size if appropriate.</p>

<h3 id="callback-specification">Callback Specification</h3>

<p>Callback functions that are given to Onyx for monitoring take exactly two parameters. The first parameter is the monitoring configuration, the second is a map. The return value of the function is ignored. The event names and keys in their corresponding maps are listed in a later section of this chapter, as well as a discussion about monitoring configuration. Here&#39;s an example of a callback function:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">do-something</span> <span class="p">[</span><span class="nv">config</span> <span class="p">{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">event</span> <span class="nv">latency</span> <span class="nv">bytes</span><span class="p">]}]</span>
  <span class="c1">;; Write some metrics to Riemann or another type of services.</span>
  <span class="p">(</span><span class="nf">send-to-riemann</span> <span class="nv">event</span> <span class="nv">latency</span> <span class="nv">bytes</span><span class="p">))</span>
</code></pre></div>
<h3 id="registering-callbacks">Registering Callbacks</h3>

<p>To register callbacks, create a map of event name key to callback function. This map must have a key <code>:monitoring</code>, mapped to keyword <code>:custom</code>. If you want to ignore all callbacks, you can instead supply <code>:no-op</code>. Monitoring is optional, so you can skip any monitoring code entirely if you don&#39;t want to use this feature.</p>

<p>A registration example might look like:</p>
<div class="highlight"><pre><code class="language-clojure" data-lang="clojure"><span class="p">(</span><span class="kd">defn </span><span class="nv">std-out</span> <span class="p">[</span><span class="nv">config</span> <span class="nv">event-map</span><span class="p">]</span>
  <span class="c1">;; `config` is the `monitoring-config` var.</span>
  <span class="p">(</span><span class="nb">prn </span><span class="nv">event-map</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">monitoring-config</span>
  <span class="p">{</span><span class="ss">:monitoring</span> <span class="ss">:custom</span>
   <span class="ss">:zookeeper-write-log-entry</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-read-log-entry</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-write-catalog</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-write-workflow</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-write-flow-conditions</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-force-write-chunk</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-read-catalog</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-read-lifecycles</span> <span class="nv">std-out</span>
   <span class="ss">:zookeeper-gc-log-entry</span> <span class="nv">std-out</span><span class="p">})</span>

<span class="c1">;; Pass the monitoring config as a third parameter to the `start-peers` function.</span>
<span class="p">(</span><span class="k">def </span><span class="nv">v-peers</span> <span class="p">(</span><span class="nf">onyx.api/start-peers</span> <span class="mi">3</span> <span class="nv">peer-group</span> <span class="nv">monitoring-config</span><span class="p">))</span>
</code></pre></div>
<h3 id="monitoring-events">Monitoring Events</h3>

<p>This is the list of all monitoring events that you can register hooks for. The keys listed are present in the map that is passed to the callback function. The names of the events should readily identify what has taken place to trigger the callback.</p>

<table><thead>
<tr>
<th>Event name</th>
<th>Keys</th>
</tr>
</thead><tbody>
<tr>
<td><code>:zookeeper-write-log-entry</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-log-entry</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-catalog</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-workflow</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-flow-conditions</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-lifecycles</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-windows</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-triggers</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-task</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-chunk</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-job-scheduler</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-messaging</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-exception</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-force-write-chunk</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-write-origin</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:bytes</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-catalog</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-workflow</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-flow-conditions</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-lifecycles</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-windows</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-triggers</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-task</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-chunk</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-origin</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-job-scheduler</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-messaging</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-read-exception</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:zookeeper-gc-log-entry</code></td>
<td><code>:event</code>, <code>:latency</code>, <code>:position</code></td>
</tr>
<tr>
<td><code>:peer-ack-segments</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:peer-retry-segment</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:peer-complete-message</code></td>
<td><code>:event</code>, <code>:latency</code></td>
</tr>
<tr>
<td><code>:peer-gc-peer-link</code></td>
<td><code>:event</code></td>
</tr>
<tr>
<td><code>:peer-backpressure-on</code></td>
<td><code>:event</code>, <code>:id</code></td>
</tr>
<tr>
<td><code>:peer-backpressure-off</code></td>
<td><code>:event</code>, <code>:id</code></td>
</tr>
<tr>
<td><code>:peer-prepare-join</code></td>
<td><code>:event</code>, <code>:id</code></td>
</tr>
<tr>
<td><code>:peer-notify-join</code></td>
<td><code>:event</code>, <code>:id</code></td>
</tr>
<tr>
<td><code>:peer-accept-join</code></td>
<td><code>:event</code>, <code>:id</code></td>
</tr>
<tr>
<td><code>:peer-send-bytes</code></td>
<td><code>:event</code>, <code>:id</code>, <code>:bytes</code></td>
</tr>
</tbody></table>

    </div>
  </div>
</div>


    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <small><center>Copyright © Distributed Masonry 2016</center></small>
    </div>

  </div>

</footer>

  </body>

</html>
